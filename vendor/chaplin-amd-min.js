/*
Chaplin 1.0.0-pre.

Chaplin may be freely distributed under the MIT license.
For all details and documentation:
http://github.com/chaplinjs/chaplin
*/(function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},d=function(a,b){return function(){return a.apply(b,arguments)}},e=Array.prototype.slice;define("chaplin/application",["backbone","chaplin/mediator","chaplin/dispatcher","chaplin/views/layout","chaplin/lib/router"],function(a,b,c,d,e){"use strict";var f;return f=function(){function b(){}return b.extend=a.Model.extend,b.prototype.title="",b.prototype.dispatcher=null,b.prototype.layout=null,b.prototype.router=null,b.prototype.initialize=function(){},b.prototype.initDispatcher=function(a){return this.dispatcher=new c(a)},b.prototype.initLayout=function(a){return a==null&&(a={}),a.title==null&&(a.title=this.title),this.layout=new d(a)},b.prototype.initRouter=function(a,b){return this.router=new e(b),typeof a=="function"&&a(this.router.match),this.router.startHistory()},b.prototype.disposed=!1,b.prototype.dispose=function(){var a,b,c,d;if(this.disposed)return;b=["dispatcher","layout","router"];for(c=0,d=b.length;c<d;c++)a=b[c],this[a].dispose(),delete this[a];return this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},b}()}),define("chaplin/mediator",["underscore","backbone","chaplin/lib/support","chaplin/lib/utils"],function(a,b,c,d){"use strict";var e;return e={},e.subscribe=e.on=b.Events.on,e.unsubscribe=e.off=b.Events.off,e.publish=e.trigger=b.Events.trigger,e._callbacks=null,d.readonly(e,"subscribe","unsubscribe","publish","on","off","trigger"),e.seal=function(){if(c.propertyDescriptors&&Object.seal)return Object.seal(e)},d.readonly(e,"seal"),e}),define("chaplin/dispatcher",["underscore","chaplin/mediator","chaplin/lib/utils","chaplin/lib/subscriber"],function(a,b,c,d){"use strict";var e;return e=function(){function e(){this.initialize.apply(this,arguments)}return a(e.prototype).extend(d),e.prototype.previousControllerName=null,e.prototype.currentControllerName=null,e.prototype.currentController=null,e.prototype.currentAction=null,e.prototype.currentParams=null,e.prototype.url=null,e.prototype.initialize=function(b){return b==null&&(b={}),this.settings=a(b).defaults({controllerPath:"controllers/",controllerSuffix:"_controller"}),this.subscribeEvent("matchRoute",this.matchRoute),this.subscribeEvent("!startupController",this.startupController)},e.prototype.matchRoute=function(a,b){return this.startupController(a.controller,a.action,b)},e.prototype.startupController=function(b,c,d){var e,f;c==null&&(c="index"),d==null&&(d={}),d.changeURL!==!1&&(d.changeURL=!0),d.forceStartup!==!0&&(d.forceStartup=!1),f=!d.forceStartup&&this.currentControllerName===b&&this.currentAction===c&&(!this.currentParams||a(d).isEqual(this.currentParams));if(f)return;return e=a(this.controllerLoaded).bind(this,b,c,d),this.loadController(b,e)},e.prototype.loadController=function(a,b){var d,e;return d=c.underscorize(a)+this.settings.controllerSuffix,e=this.settings.controllerPath+d,(typeof define!="undefined"&&define!==null?define.amd:void 0)?require([e],b):b(require(e))},e.prototype.controllerLoaded=function(a,c,d,e){var f,g,h;h=this.currentControllerName||null,g=this.currentController||null,g&&(b.publish("beforeControllerDispose",g),g.dispose(d,a)),f=new e(d,h),f[c](d,h);if(f.redirected)return;return this.previousControllerName=h,this.currentControllerName=a,this.currentController=f,this.currentAction=c,this.currentParams=d,this.adjustURL(f,d),b.publish("startupController",{previousControllerName:this.previousControllerName,controller:this.currentController,controllerName:this.currentControllerName,params:this.currentParams})},e.prototype.adjustURL=function(a,c){var d;if(c.path)d=c.path;else if(typeof a.historyURL=="function")d=a.historyURL(c);else{if(typeof a.historyURL!="string")throw new Error("Dispatcher#adjustURL: controller for "+(""+this.currentControllerName+" does not provide a historyURL"));d=a.historyURL}return c.changeURL&&b.publish("!router:changeURL",d),this.url=d},e.prototype.disposed=!1,e.prototype.dispose=function(){if(this.disposed)return;return this.unsubscribeAllEvents(),this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},e}()}),define("chaplin/controllers/controller",["underscore","backbone","chaplin/mediator","chaplin/lib/subscriber"],function(b,c,d,e){"use strict";var f;return f=function(){function f(){this.initialize.apply(this,arguments)}return f.extend=c.Model.extend,b(f.prototype).extend(e),f.prototype.view=null,f.prototype.currentId=null,f.prototype.redirected=!1,f.prototype.initialize=function(){},f.prototype.redirectTo=function(a,b,c){return this.redirected=!0,arguments.length===1?d.publish("!router:route",a,function(a){if(!a)throw new Error("Controller#redirectTo: no route matched")}):d.publish("!startupController",a,b,c)},f.prototype.disposed=!1,f.prototype.dispose=function(){var b,c,d,e,f;if(this.disposed)return;for(c in this){if(!a.call(this,c))continue;b=this[c],b&&typeof b.dispose=="function"&&(b.dispose(),delete this[c])}this.unsubscribeAllEvents(),d=["currentId","redirected"];for(e=0,f=d.length;e<f;e++)c=d[e],delete this[c];return this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},f}()}),define("chaplin/models/collection",["underscore","backbone","chaplin/lib/subscriber","chaplin/lib/sync_machine","chaplin/models/model"],function(a,c,d,e,f){"use strict";var g;return g=function(c){function g(){g.__super__.constructor.apply(this,arguments)}return b(g,c),a(g.prototype).extend(d),g.prototype.model=f,g.prototype.initDeferred=function(){return a(this).extend($.Deferred())},g.prototype.initSyncMachine=function(){return a(this).extend(e)},g.prototype.addAtomic=function(a,b){var c,d;b==null&&(b={});if(!a.length)return;b.silent=!0,c=typeof b.at=="number"?"pop":"shift";while(d=a[c]())this.add(d,b);return this.trigger("reset")},g.prototype.update=function(b,c){var d,e,f,g,h,i,j,k,l;c==null&&(c={}),d=this.pluck("id").join(),f=a(b).pluck("id"),h=f.join();if(h!==d){j=a(f),e=this.models.length;while(e--)g=this.models[e],j.include(g.id)||this.remove(g)}if(h!==d||c.deep){l=[];for(e=0,k=b.length;e<k;e++)g=b[e],i=this.get(g.id),i?c.deep?l.push(i.set(g)):l.push(void 0):l.push(this.add(g,{at:e}));return l}},g.prototype.disposed=!1,g.prototype.dispose=function(){var a,b,c,d;if(this.disposed)return;this.trigger("dispose",this),this.reset([],{silent:!0}),this.unsubscribeAllEvents(),this.off(),typeof this.reject=="function"&&this.reject(),b=["model","models","_byId","_byCid","_callbacks"];for(c=0,d=b.length;c<d;c++)a=b[c],delete this[a];return this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},g}(c.Collection)}),define("chaplin/models/model",["underscore","backbone","chaplin/lib/utils","chaplin/lib/subscriber","chaplin/lib/sync_machine"],function(a,d,e,f,g){"use strict";var h;return h=function(h){function j(){j.__super__.constructor.apply(this,arguments)}var i;return b(j,h),a(j.prototype).extend(f),j.prototype.initDeferred=function(){return a(this).extend($.Deferred())},j.prototype.initSyncMachine=function(){return a(this).extend(g)},j.prototype.getAttributes=function(){return this.attributes},i=function(a,b,f){var g,h,k,l;f?f.push(a):(g=e.beget(b),f=[a]);for(k in b)l=b[k],l instanceof j?(g==null&&(g=e.beget(b)),g[k]=l===a||c.call(f,l)>=0?null:i(l,l.getAttributes(),f)):l instanceof d.Collection&&(g==null&&(g=e.beget(b)),g[k]=function(){var a,b,c,d;c=l.models,d=[];for(a=0,b=c.length;a<b;a++)h=c[a],d.push(i(h,h.getAttributes(),f));return d}());return f.pop(),g||b},j.prototype.serialize=function(a){return i(this,this.getAttributes())},j.prototype.disposed=!1,j.prototype.dispose=function(){var a,b,c,d;if(this.disposed)return;this.trigger("dispose",this),this.unsubscribeAllEvents(),this.off(),typeof this.reject=="function"&&this.reject(),b=["collection","attributes","changed","_escapedAttributes","_previousAttributes","_silent","_pending","_callbacks"];for(c=0,d=b.length;c<d;c++)a=b[c],delete this[a];return this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},j}(d.Model)}),define("chaplin/views/layout",["jquery","underscore","backbone","chaplin/mediator","chaplin/lib/utils","chaplin/lib/subscriber"],function(a,b,c,e,f,g){"use strict";var h;return h=function(){function h(){this.openLink=d(this.openLink,this),this.initialize.apply(this,arguments)}return h.extend=c.Model.extend,b(h.prototype).extend(g),h.prototype.title="",h.prototype.events={},h.prototype.el=document,h.prototype.$el=a(document),h.prototype.cid="chaplin-layout",h.prototype.initialize=function(a){a==null&&(a={}),this.title=a.title,this.settings=b(a).defaults({routeLinks:!0,scrollTo:[0,0]}),this.subscribeEvent("beforeControllerDispose",this.hideOldView),this.subscribeEvent("startupController",this.showNewView),this.subscribeEvent("startupController",this.adjustTitle),this.delegateEvents();if(this.settings.routeLinks)return this.initLinkRouting()},h.prototype.undelegateEvents=c.View.prototype.undelegateEvents,h.prototype.delegateEvents=c.View.prototype.delegateEvents,h.prototype.hideOldView=function(a){var b;this.settings.scrollTo&&scrollTo(this.settings.scrollTo),b=a.view;if(b)return b.$el.css("display","none")},h.prototype.showNewView=function(a){var b;b=a.controller.view;if(b)return b.$el.css({display:"block",opacity:1,visibility:"visible"})},h.prototype.adjustTitle=function(a){var b,c;return c=this.title,b=a.controller.title,b&&(c=""+b+" â€“ "+c),setTimeout(function(){return document.title=c},50)},h.prototype.initLinkRouting=function(){return a(document).on("click",".go-to",this.goToHandler).on("click","a",this.openLink)},h.prototype.stopLinkRouting=function(){return a(document).off("click",".go-to",this.goToHandler).off("click","a",this.openLink)},h.prototype.openLink=function(b){var c,d,g,h,i;if(f.modifierKeyPressed(b))return;d=b.currentTarget,h=d.getAttribute("href");if(h===null||h===""||h.charAt(0)==="#"||a(d).hasClass("noscript"))return;c=location.hostname.replace(".","\\."),g=!RegExp(""+c+"$","i").test(d.hostname);if(g)return;return i=d.pathname+d.search,i.charAt(0)!=="/"&&(i="/"+i),e.publish("!router:route",i,function(a){if(a)return b.preventDefault()})},h.prototype.goToHandler=function(b){var c,d;c=b.currentTarget;if(b.nodeName==="A")return;d=a(c).data("href");if(!d)return;return e.publish("!router:route",d,function(a){return a?b.preventDefault():location.href=d})},h.prototype.disposed=!1,h.prototype.dispose=function(){if(this.disposed)return;return this.stopLinkRouting(),this.unsubscribeAllEvents(),this.undelegateEvents(),delete this.title,this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},h}()}),define("chaplin/views/view",["jquery","underscore","backbone","chaplin/lib/utils","chaplin/lib/subscriber","chaplin/models/model"],function(a,c,d,e,f,g){"use strict";var h;return h=function(d){function g(){this.initialize!==g.prototype.initialize&&this.wrapMethod("initialize"),this.render!==g.prototype.render?this.wrapMethod("render"):this.render=c(this.render).bind(this),g.__super__.constructor.apply(this,arguments)}return b(g,d),c(g.prototype).extend(f),g.prototype.autoRender=!1,g.prototype.container=null,g.prototype.containerMethod="append",g.prototype.subviews=null,g.prototype.subviewsByName=null,g.prototype.wrapMethod=function(a){var b,c;return c=this,b=c[a],c[""+a+"IsWrapped"]=!0,c[a]=function(){return this.disposed?!1:(b.apply(c,arguments),c["after"+e.upcase(a)].apply(c,arguments),c)}},g.prototype.initialize=function(a){var b,c,d,e;if(a){e=["autoRender","container","containerMethod"];for(c=0,d=e.length;c<d;c++)b=e[c],a[b]!=null&&(this[b]=a[b])}this.subviews=[],this.subviewsByName={},(this.model||this.collection)&&this.modelBind("dispose",this.dispose);if(!this.initializeIsWrapped)return this.afterInitialize()},g.prototype.afterInitialize=function(){if(this.autoRender)return this.render()},g.prototype.delegate=function(a,b,d){var e,f;if(typeof a!="string")throw new TypeError("View#delegate: first argument must be a string");if(arguments.length===2)e=b;else{if(arguments.length!==3)throw new TypeError("View#delegate: only two or three arguments are allowed");f=b;if(typeof f!="string")throw new TypeError("View#delegate: second argument must be a string");e=d}if(typeof e!="function")throw new TypeError("View#delegate: handler argument must be function");return a+=".delegate"+this.cid,e=c(e).bind(this),f?this.$el.on(a,f,e):this.$el.on(a,e),e},g.prototype.undelegate=function(){return this.$el.unbind(".delegate"+this.cid)},g.prototype.modelBind=function(a,b){var c;if(typeof a!="string")throw new TypeError("View#modelBind: type must be a string");if(typeof b!="function")throw new TypeError("View#modelBind: handler argument must be function");c=this.model||this.collection;if(!c)throw new TypeError("View#modelBind: no model or collection set");return c.off(a,b,this),c.on(a,b,this)},g.prototype.modelUnbind=function(a,b){var c;if(typeof a!="string")throw new TypeError("View#modelUnbind: type argument must be a string");if(typeof b!="function")throw new TypeError("View#modelUnbind: handler argument must be a function");c=this.model||this.collection;if(!c)return;return c.off(a,b)},g.prototype.modelUnbindAll=function(){var a;a=this.model||this.collection;if(!a)return;return a.off(null,null,this)},g.prototype.pass=function(a,b){var c=this;return this.modelBind("change:"+a,function(a,d){var e;return e=c.$(b),e.is(":input")?e.val(d):e.text(d)})},g.prototype.subview=function(a,b){if(a&&b)return this.removeSubview(a),this.subviews.push(b),this.subviewsByName[a]=b,b;if(a)return this.subviewsByName[a]},g.prototype.removeSubview=function(a){var b,d,e,f,g,h;if(!a)return;if(typeof a=="string")d=a,g=this.subviewsByName[d];else{g=a,h=this.subviewsByName;for(e in h){f=h[e];if(g===f){d=e;break}}}if(!(d&&g&&g.dispose))return;return g.dispose(),b=c(this.subviews).indexOf(g),b>-1&&this.subviews.splice(b,1),delete this.subviewsByName[d]},g.prototype.getTemplateData=function(){var a,b,c,d,e,f,g;if(this.model)d=this.model.serialize();else if(this.collection){a=[],g=this.collection.models;for(e=0,f=g.length;e<f;e++)b=g[e],a.push(b.serialize());d={items:a}}else d={};return c=this.model||this.collection,c&&(typeof c.state=="function"&&!("resolved"in d)&&(d.resolved=c.state()==="resolved"),typeof c.isSynced=="function"&&!("synced"in d)&&(d.synced=c.isSynced())),d},g.prototype.getTemplateFunction=function(){throw new Error("View#getTemplateFunction must be overridden")},g.prototype.render=function(){var a,b;return this.disposed?!1:(b=this.getTemplateFunction(),typeof b=="function"&&(a=b(this.getTemplateData()),this.$el.empty().append(a)),this.renderIsWrapped||this.afterRender(),this)},g.prototype.afterRender=function(){if(this.container)return a(this.container)[this.containerMethod](this.el),this.trigger("addedToDOM")},g.prototype.disposed=!1,g.prototype.dispose=function(){var a,b,c,d,e,f,g,h;if(this.disposed)return;h=this.subviews;for(d=0,f=h.length;d<f;d++)c=h[d],c.dispose();this.unsubscribeAllEvents(),this.modelUnbindAll(),this.off(),this.$el.remove(),b=["el","$el","options","model","collection","subviews","subviewsByName","_callbacks"];for(e=0,g=b.length;e<g;e++)a=b[e],delete this[a];return this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},g}(d.View)}),define("chaplin/views/collection_view",["jquery","underscore","chaplin/views/view"],function(c,e,f){"use strict";var g;return g=function(c){function f(){this.renderAllItems=d(this.renderAllItems,this),this.showHideFallback=d(this.showHideFallback,this),this.itemsResetted=d(this.itemsResetted,this),this.itemRemoved=d(this.itemRemoved,this),this.itemAdded=d(this.itemAdded,this),f.__super__.constructor.apply(this,arguments)}return b(f,c),f.prototype.animationDuration=500,f.prototype.listSelector=null,f.prototype.$list=null,f.prototype.fallbackSelector=null,f.prototype.$fallback=null,f.prototype.loadingSelector=null,f.prototype.$loading=null,f.prototype.itemSelector=null,f.prototype.itemView=null,f.prototype.filterer=null,f.prototype.viewsByCid=null,f.prototype.visibleItems=null,f.prototype.getView=function(a){if(this.itemView!=null)return new this.itemView({model:a});throw new Error("The CollectionView#itemView property must bedefined (or the getView() must be overridden)")},f.prototype.getTemplateFunction=function(){},f.prototype.initialize=function(a){a==null&&(a={}),f.__super__.initialize.apply(this,arguments),e(a).defaults({render:!0,renderItems:!0,filterer:null}),a.itemView!=null&&(this.itemView=a.itemView),this.viewsByCid={},this.visibleItems=[],this.addCollectionListeners(),a.filterer&&this.filter(a.filterer),a.render&&this.render();if(a.renderItems)return this.renderAllItems()},f.prototype.addCollectionListeners=function(){return this.modelBind("add",this.itemAdded),this.modelBind("remove",this.itemRemoved),this.modelBind("reset",this.itemsResetted)},f.prototype.itemAdded=function(a,b,c){return c==null&&(c={}),this.renderAndInsertItem(a,c.index)},f.prototype.itemRemoved=function(a){return this.removeViewForItem(a)},f.prototype.itemsResetted=function(){return this.renderAllItems()},f.prototype.render=function(){return f.__super__.render.apply(this,arguments),this.$list=this.listSelector?this.$(this.listSelector):this.$el,this.initFallback(),this.initLoadingIndicator()},f.prototype.initFallback=function(){if(!this.fallbackSelector)return;return this.$fallback=this.$(this.fallbackSelector),this.bind("visibilityChange",this.showHideFallback),this.modelBind("syncStateChange",this.showHideFallback)},f.prototype.showHideFallback=function(){var a;return a=this.visibleItems.length===0&&(typeof this.collection.isSynced=="function"?this.collection.isSynced():!0),this.$fallback.css("display",a?"block":"none")},f.prototype.initLoadingIndicator=function(){if(!this.loadingSelector||typeof this.collection.isSyncing!="function")return;return this.$loading=this.$(this.loadingSelector),this.modelBind("syncStateChange",this.showHideLoadingIndicator),this.showHideLoadingIndicator()},f.prototype.showHideLoadingIndicator=function(){var a;return a=this.collection.length===0&&this.collection.isSyncing(),this.$loading.css("display",a?"block":"none")},f.prototype.filter=function(a){var b,c,d,f,g,h;this.filterer=a;if(!e(this.viewsByCid).isEmpty()){h=this.collection.models;for(c=0,g=h.length;c<g;c++){d=h[c],b=typeof a=="function"?a(d,c):!0,f=this.viewsByCid[d.cid];if(!f)throw new Error("CollectionView#filter: "+("no view found for "+d.cid));f.$el.stop(!0,!0).css("display",b?"":"none"),this.updateVisibleItems(d,b,!1)}}return this.trigger("visibilityChange",this.visibleItems)},f.prototype.renderAllItems=function(){var b,c,d,e,f,g,h,i,j,k;e=this.collection.models,this.visibleItems=[],f={};for(h=0,i=e.length;h<i;h++)d=e[h],g=this.viewsByCid[d.cid],g&&(f[d.cid]=g);k=this.viewsByCid;for(b in k){if(!a.call(k,b))continue;g=k[b],b in f||this.removeView(b,g)}for(c=0,j=e.length;c<j;c++)d=e[c],g=this.viewsByCid[d.cid],g?this.insertView(d,g,c,0):this.renderAndInsertItem(d,c);if(!e.length)return this.trigger("visibilityChange",this.visibleItems)},f.prototype.renderAndInsertItem=function(a,b){var c;return c=this.renderItem(a),this.insertView(a,c,b)},f.prototype.renderItem=function(a){var b;return b=this.viewsByCid[a.cid],b||(b=this.getView(a),this.viewsByCid[a.cid]=b),b.render(),b},f.prototype.insertView=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;c==null&&(c=null),d==null&&(d=this.animationDuration),l=typeof c=="number"?c:this.collection.indexOf(a),j=typeof this.filterer=="function"?this.filterer(a,l):!0,m=b.el,h=b.$el,j?(d&&h.addClass("opacity-transitionable"),d&&h.css("opacity",0)):h.css("display","none"),e=this.$list,i=e.children(this.itemSelector||void 0),k=i.length,k===0||l===k?e.append(m):l===0?(f=i.eq(l),f.before(m)):(g=i.eq(l-1),g.after(m)),b.trigger("addedToDOM"),this.updateVisibleItems(a,j);if(d&&j)return h.addClass("opacity-transitionable-end"),h.animate({opacity:1},d)},f.prototype.removeViewForItem=function(a){var b;return this.updateVisibleItems(a,!1),b=this.viewsByCid[a.cid],this.removeView(a.cid,b)},f.prototype.removeView=function(a,b){return b.dispose(),delete this.viewsByCid[a]},f.prototype.updateVisibleItems=function(a,b,c){var d,f,g;return c==null&&(c=!0),f=!1,g=e(this.visibleItems).indexOf(a),d=g>-1,b&&!d?(this.visibleItems.push(a),f=!0):!b&&d&&(this.visibleItems.splice(g,1),f=!0),f&&c&&this.trigger("visibilityChange",this.visibleItems),f},f.prototype.dispose=function(){var b,c,d,e,g,h,i;if(this.disposed)return;i=this.viewsByCid;for(b in i){if(!a.call(i,b))continue;e=i[b],e.dispose()}d=["$list","$fallback","$loading","viewsByCid","visibleItems"];for(g=0,h=d.length;g<h;g++)c=d[g],delete this[c];return f.__super__.dispose.apply(this,arguments)},f}(f)}),define("chaplin/lib/route",["underscore","chaplin/mediator","chaplin/controllers/controller"],function(b,c,e){"use strict";var f;return f=function(){function j(a,c,f){var g;this.options=f!=null?f:{},this.handler=d(this.handler,this),this.addParamName=d(this.addParamName,this),this.pattern=a,g=c.split("#"),this.controller=g[0],this.action=g[1];if(b(e.prototype).has(this.action))throw new Error("Route: You should not use existing controller properties as action names");this.createRegExp()}var f,g,h,i;return i=["path","changeURL"],f=/[-[\]{}()+?.,\\^$|#\s]/g,g="&",h="=",j.prototype.createRegExp=function(){var a;if(b.isRegExp(this.pattern)){this.regExp=this.pattern;return}return a=this.pattern.replace(f,"\\$&").replace(/:(\w+)/g,this.addParamName),this.regExp=RegExp("^"+a+"(?=\\?|$)")},j.prototype.addParamName=function(a,c){this.paramNames==null&&(this.paramNames=[]);if(b(i).include(c))throw new Error("Route#addParamName: parameter name "+c+" is reserved");return this.paramNames.push(c),"([^/]+)"},j.prototype.test=function(b){var c,d,e,f,g;e=this.regExp.test(b);if(!e)return!1;d=this.options.constraints;if(d){g=this.extractParams(b);for(f in d){if(!a.call(d,f))continue;c=d[f];if(!c.test(g[f]))return!1}}return!0},j.prototype.handler=function(a,b){var d;return d=this.buildParams(a,b),c.publish("matchRoute",this,d)},j.prototype.buildParams=function(a,c){var d,e,f;return d={},f=this.extractQueryParams(a),b(d).extend(f),e=this.extractParams(a),b(d).extend(e),b(d).extend(this.options.params),d.changeURL=Boolean(c&&c.changeURL),d.path=a,d},j.prototype.extractParams=function(a){var b,c,d,e,f,g,h;f={},d=this.regExp.exec(a),h=d.slice(1);for(b=0,g=h.length;b<g;b++)c=h[b],e=this.paramNames?this.paramNames[b]:b,f[e]=c;return f},j.prototype.extractQueryParams=function(a){var b,c,d,e,f,i,j,k,l,m,n,o;i={},k=/\?(.+?)(?=#|$)/,d=k.exec(a);if(!d)return i;j=d[1],f=j.split(g);for(m=0,n=f.length;m<n;m++){e=f[m];if(!e.length)continue;o=e.split(h),c=o[0],l=o[1];if(!c.length)continue;c=decodeURIComponent(c),l=decodeURIComponent(l),b=i[c],b?b.push?b.push(l):i[c]=[b,l]:i[c]=l}return i},j}()}),define("chaplin/lib/router",["underscore","backbone","chaplin/mediator","chaplin/lib/subscriber","chaplin/lib/route"],function(a,b,c,e,f){"use strict";var g;return g=function(){function c(b){this.options=b!=null?b:{},this.route=d(this.route,this),this.match=d(this.match,this),a(this.options).defaults({pushState:!0}),this.subscribeEvent("!router:route",this.routeHandler),this.subscribeEvent("!router:changeURL",this.changeURLHandler),this.createHistory()}return a(c.prototype).extend(e),c.prototype.createHistory=function(){return b.history||(b.history=new b.History)},c.prototype.startHistory=function(){return b.history.start(this.options)},c.prototype.stopHistory=function(){return b.history.stop()},c.prototype.match=function(a,c,d){var e;return d==null&&(d={}),e=new f(a,c,d),b.history.route(e,e.handler)},c.prototype.route=function(a){var c,d,e,f;a=a.replace(/^(\/#|\/)/,""),f=b.history.handlers;for(d=0,e=f.length;d<e;d++){c=f[d];if(c.route.test(a))return c.callback(a,{changeURL:!0}),!0}return!1},c.prototype.routeHandler=function(a,b){var c;return c=this.route(a),typeof b=="function"?b(c):void 0},c.prototype.changeURL=function(a){return b.history.navigate(a,{trigger:!1})},c.prototype.changeURLHandler=function(a){return this.changeURL(a)},c.prototype.disposed=!1,c.prototype.dispose=function(){if(this.disposed)return;return this.stopHistory(),delete b.history,this.unsubscribeAllEvents(),this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},c}()}),define("chaplin/lib/subscriber",["chaplin/mediator"],function(a){"use strict";var b;return b={subscribeEvent:function(b,c){if(typeof b!="string")throw new TypeError("Subscriber#subscribeEvent: type argument must be a string");if(typeof c!="function")throw new TypeError("Subscriber#subscribeEvent: handler argument must be a function");return a.unsubscribe(b,c,this),a.subscribe(b,c,this)},unsubscribeEvent:function(b,c){if(typeof b!="string")throw new TypeError("Subscriber#unsubscribeEvent: type argument must be a string");if(typeof c!="function")throw new TypeError("Subscriber#unsubscribeEvent: handler argument must be a function");return a.unsubscribe(b,c)},unsubscribeAllEvents:function(){return a.unsubscribe(null,null,this)}},typeof Object.freeze=="function"&&Object.freeze(b),b}),define("chaplin/lib/support",function(){"use strict";var a;return a={propertyDescriptors:function(){var a;if(typeof Object.defineProperty!="function"||typeof Object.defineProperties!="function")return!1;try{return a={},Object.defineProperty(a,"foo",{value:"bar"}),a.foo==="bar"}catch(b){return!1}}()},a}),define("chaplin/lib/sync_machine",function(){"use strict";var a,b,c,d,e,f,g,h,i,j;e="unsynced",c="syncing",b="synced",a="syncStateChange",d={_syncState:e,_previousSyncState:null,syncState:function(){return this._syncState},isUnsynced:function(){return this._syncState===e},isSynced:function(){return this._syncState===b},isSyncing:function(){return this._syncState===c},unsync:function(){var d;if((d=this._syncState)===c||d===b)this._previousSync=this._syncState,this._syncState=e,this.trigger(this._syncState,this,this._syncState),this.trigger(a,this,this._syncState)},beginSync:function(){var d;if((d=this._syncState)===e||d===b)this._previousSync=this._syncState,this._syncState=c,this.trigger(this._syncState,this,this._syncState),this.trigger(a,this,this._syncState)},finishSync:function(){this._syncState===c&&(this._previousSync=this._syncState,this._syncState=b,this.trigger(this._syncState,this,this._syncState),this.trigger(a,this,this._syncState))},abortSync:function(){this._syncState===c&&(this._syncState=this._previousSync,this._previousSync=this._syncState,this.trigger(this._syncState,this,this._syncState),this.trigger(a,this,this._syncState))}},j=[e,c,b,a],g=function(a){return d[a]=function(b,c){c==null&&(c=this),this.on(a,b,c);if(this._syncState===a)return b.call(c)}};for(h=0,i=j.length;h<i;h++)f=j[h],g(f);return typeof Object.freeze=="function"&&Object.freeze(d),d}),define("chaplin/lib/utils",["chaplin/lib/support"],function(a){"use strict";var b;return b={beget:function(){var a;return typeof Object.create=="function"?Object.create:(a=function(){},function(b){return a.prototype=b,new a})}(),readonly:function(){var b;return a.propertyDescriptors?(b={writable:!1,enumerable:!0,configurable:!1},function(){var a,c,d,f,g;a=arguments[0],d=2<=arguments.length?e.call(arguments,1):[];for(f=0,g=d.length;f<g;f++)c=d[f],Object.defineProperty(a,c,b);return!0}):function(){return!1}}(),upcase:function(a){return a.charAt(0).toUpperCase()+a.substring(1)},underscorize:function(a){return a.replace(/[A-Z]/g,function(a,b){return(b!==0?"_":"")+a.toLowerCase()})},modifierKeyPressed:function(a){return a.shiftKey||a.altKey||a.ctrlKey||a.metaKey}},typeof Object.seal=="function"&&Object.seal(b),b}),define("chaplin",["chaplin/application","chaplin/mediator","chaplin/dispatcher","chaplin/controllers/controller","chaplin/models/collection","chaplin/models/model","chaplin/views/layout","chaplin/views/view","chaplin/views/collection_view","chaplin/lib/route","chaplin/lib/router","chaplin/lib/subscriber","chaplin/lib/support","chaplin/lib/sync_machine","chaplin/lib/utils"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return{Application:a,mediator:b,Dispatcher:c,Controller:d,Collection:e,Model:f,Layout:g,View:h,CollectionView:i,Route:j,Router:k,Subscriber:l,support:m,SyncMachine:n,utils:o}})}).call(this);